---
layout: post
title: mysql互为主从配置
date: 2025-12-10 09:00:00 +0800
category: 笔记
thumbnail: /style/image/thumbnail.png
icon: note
typora-copy-images-to: ..\style\image
---

* 目录
{:toc}
服务机107
服务机108

提示，如果不需要互为主从，只要主从备份只需要执行三大点中的（1）小点命令就行

### 一、修改配置文件/home/app/mysql-5.7.41/my.cnf

1.服务机107设置（2个配置文件就是server-id不一样，从数据库配置可以忽略一些表）

```mysql
#主从设置开始server-id不一样
server-id = 1
log-bin = mysql-bin
#忽略写入binlog日志的库
binlog-ignore-db = mysql,information_schema
#字段变化增量值   
auto-increment-increment = 2
#初始字段ID为1
auto-increment-offset = 1
#忽略所有复制产生的错误 
slave-skip-errors = all
#配置表名不区分大小写
lower_case_table_names=1
#忽略哪个数据库的哪张表(注意不能批量有个排除就写几个，但这个可以like表达式%)
replicate-wild-ignore-table = test.log%
replicate-wild-ignore-table = test.access
```

2.服务机108设置

```mysql
#主从设置开始server-id不一样
server-id = 2
log-bin = mysql-bin
#忽略写入binlog日志的库
binlog-ignore-db = mysql,information_schema
#字段变化增量值   
auto-increment-increment = 2
#初始字段ID为1
auto-increment-offset = 1
#忽略所有复制产生的错误 
slave-skip-errors = all
#配置表名不区分大小写
lower_case_table_names=1
#忽略哪个数据库的哪张表(注意不能批量有个排除就写几个，但这个可以like表达式%)
replicate-wild-ignore-table = test.log%
replicate-wild-ignore-table = test.access
```

### 二、重新启动数据库

```shell
systemctl restart mysql
```

### 三、登录命令行执行命令

```shel
//指定socket登录也可以使用其他登录命令
mysql -uroot --socket=/home/app/mysql-5.7.41/data/mysql.sock -p
//常见登录命令
mysql -uroot -p
```

(1)、108同步107的数据
ip填写从服务器ip，replication是创建的mysql用户名

1.主机107执行
	创建账户并授予REPLICATION SLAVE权限

```mysql
grant replication slave on *.* to 'replication'@'192.168.56.108' identified  by 'HuxryedYcU8N';
flush  privileges;
```

2.从机108执行
绑定主机（master_host：主机ip master_user:上面创建的拥有REPLICATION SLAVE权限的账号 master_password： 密码）
master_log_file和master_log_pos在主机的mysql命令行查看show master status;

```mysql
change  master to master_host='192.168.56.107',master_port=10010,master_user='replication',master_password='HuxryedYcU8N', master_log_file='mysql-bin.000001',master_log_pos=154;
//启动同步
start  slave;
```

(2)、107同步108的数据

1.主机108执行

```mysql
grant replication slave on *.* to 'replication'@'192.168.56.107' identified  by 'HuxryedYcU8N';
flush  privileges;
```

2.从机107执行

```mysql
change  master to master_host='192.168.56.108',master_port=10010,master_user='replication',master_password='HuxryedYcU8N', master_log_file='mysql-bin.000001',master_log_pos=154;
//启动同步
start  slave;
```



### 四、查看同步运行状态

如果启动有问题使用停止同步命令 stop slave;
2个数据库都要查看同步状态(mysql命令)

```mysql
show slave status\G
```

Slave_IO_Running与Slave_SQL_Running这两个字段都显示yes就没问题

查看A、B服务器的同步线程状态(mysql命令)

```mysql
show processlist\G
```

主备服务器的MySql进程必须都有这三个线程才证明配置成功！
state:
Master has sent all binlog to slave; waiting for more updates
Waiting for master to send event
Slave has read all relay log; waiting for more updates

### 五、结语
