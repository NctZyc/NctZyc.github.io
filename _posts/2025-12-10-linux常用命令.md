---
layout: post
title: linux常用命令
date: 2025-12-10 09:00:00 +0800
category: 笔记
thumbnail: /style/image/thumbnail.png
icon: note
typora-copy-images-to: ..\style\image
---

* 目录
{:toc}
# Linux 系统笔记

## 目录结构
Linux 文件系统采用树状结构，根目录为 `/`，常见目录及其用途如下：

- `/boot`：系统引导文件、内核
- `/bin`：用户的基本命令（如 `ls`, `cp`, `mv` 等）
- `/dev`：设备文件（如硬盘、键盘、鼠标等）
- `/etc`：系统和应用程序的配置文件
- `/home`：普通用户的主目录（如 `/home/user`）
- `/root`：root 用户的主目录
- `/sbin`：系统管理员使用的基本管理命令（如 `ifconfig`, `reboot`）
- `/tmp`：临时文件存放目录（通常重启后清空）
- `/usr`：共享的只读数据（如程序、库、文档）
- `/mnt`：临时挂载文件系统的挂载点
- `/media`：可移动设备（如 U 盘、光盘）的挂载点
- `/opt`：第三方应用程序的安装目录
- `/srv`：系统运行的服务所用到的数据（如 Web、FTP 服务数据）
- `/var`：经常变动的数据文件（如日志、邮件、缓存）
- `/proc`：虚拟文件系统，用于输出内核与进程信息
- `/sys`：虚拟文件系统，用于输出当前系统硬件设备相关信息

---
## 系统分区建议

### 必须的分区

1. `/boot` 分区

- **作用**：引导分区，包含系统启动所需的内核文件。即使根分区损坏，仍可引导系统。
- **建议大小**：100–500 MB（推荐 300–500 MB）
- **文件系统**：建议 `ext4`

2. `/`（根）分区

- **作用**：所有文件系统的起点，类似 Windows 的 C 盘。
- **建议大小**：≥15 GB（根据实际用途调整）
- **文件系统**：建议 `ext4`

3. `swap` 分区

- **作用**：虚拟内存。当物理内存不足时，系统使用 swap 空间临时存储数据。
- **建议大小**：物理内存的 1–2 倍（如 4 GB 内存 → 8 GB swap）
- **文件系统**：`swap`

### 可选分区

1. `/home` 分区

- **作用**：存放用户数据（如 `/home/username/Documents`）
- **建议大小**：若用户数据多，应适当增大
- **文件系统**：建议 `ext4`

2. `/var` 分区

- **作用**：存放日志、缓存等变动数据（如 `/var/log`）
- **建议大小**：若用于服务器或日志密集型应用，建议单独分区以避免占满根分区
- **文件系统**：建议 `ext4`

## 常用命令

### 磁盘使用情况

```shell
# 查看当前目录总占用容量
du -sh

# 查看当前目录下一级子目录/文件的磁盘使用情况
du -lh --max-depth=1
```



### 压缩与解压（tar.gz）

```bash
# 压缩目录为 .tar.gz
tar -zcvf archive.tar.gz directory/

# 解压 .tar.gz 文件
tar -zxvf archive.tar.gz
```

> 参数说明：
> - `c`：创建压缩包  
> - `x`：解压  
> - `v`：显示过程  
> - `f`：指定文件名  
> - `z`：使用 gzip 压缩

### 内核管理（清理旧内核）

```bash
# 列出所有已安装的内核
rpm -qa | grep kernel

# 列出除当前运行内核外的其他内核
rpm -qa | grep kernel | grep -v $(uname -r)

# 删除指定旧内核（替换 <kernel-name> 为实际包名）
sudo yum remove <kernel-name>

# 重启生效
sudo reboot
```

### SELinux 管理

```bash
# 查看 SELinux 状态
sestatus

# 临时关闭 SELinux（重启后恢复）
sudo setenforce 0

# 永久关闭 SELinux
# 编辑配置文件，将 SELINUX=disabled
sudo vim /etc/selinux/config
```

SELinux 端口管理（如为 HTTP 服务开放端口）

```bash
# 查看 HTTP 允许监听的端口
semanage port -l | grep http_port_t

# 添加新端口（例如 7777）
sudo semanage port -a -t http_port_t -p tcp 7777
```

> `semanage` 常用选项：
> - `-l`：列出
> - `-a`：添加
> - `-m`：修改
> - `-d`：删除
> - `fcontext`：管理文件/目录的安全上下文

### 文件权限管理

```bash
# 查看文件权限
ls -l

# 修改权限（符号模式）
chmod u+x file          # 所有者增加执行权限
chmod a=rwx file        # 所有用户设为 rwx
chmod ug=rwx,o=x file   # 所有者和组 rwx，其他人仅执行

# 修改权限（数字模式）
chmod 777 file          # 等价于 a=rwx
```

> 权限说明：
> - `u`：用户（所有者）
> - `g`：用户组
> - `o`：其他用户
> - `a`：所有用户（等同于 `ugo`）
> - 每类权限：`r=4`, `w=2`, `x=1` → `rwx = 7`

### SSH 免密登录

```bash
# 生成 Ed25519 密钥对（推荐）
ssh-keygen -t ed25519

# 将公钥复制到远程主机
ssh-copy-id user@172.16.4.213
```

### 日志搜索（grep）

```bash
# 查找日志中包含关键词的行，显示匹配前 2 行、最多 2 个结果
grep -B2 -m2 '万维实时拉取数据异常' logs/golden-touch.log
```

> 常用选项：
> - `-B N`：显示匹配行前 N 行
> - `-A N`：显示匹配行后 N 行
> - `-C N`：前后各 N 行（等同于 `-B N -A N`）
> - `-m N`：最多显示 N 个匹配结果

### 文件句柄数（打开文件限制）

```bash
# 查看当前限制
ulimit -a

# 临时提高（仅当前会话有效）
ulimit -n 65535

# 永久修改（需重启或重新登录）
sudo vim /etc/security/limits.conf
```

在 `limits.conf` 中添加：

```conf
* soft nofile 65535
* hard nofile 65535
```

> 若使用 Nginx，也可在配置中设置：
> ```nginx
> worker_rlimit_nofile 65535;
> ```
