---
layout: post
title: linux用户管理
date: 2025-12-10 09:00:00 +0800
category: 笔记
thumbnail: /style/image/thumbnail.png
icon: note
typora-copy-images-to: ..\style\image
---

* 目录
{:toc}
以下是你提供的 **Linux 用户管理模块** 内容的简洁归纳版，保留核心功能说明，命令已格式化为代码块，便于查阅使用：

# Linux 用户与权限管理常用命令

## 1. `sudo` 授权

```bash
# 编辑 sudoers 文件（需谨慎）
sudo chmod u+w /etc/sudoers
# 添加行：mary ALL=(ALL) ALL
sudo chmod u-w /etc/sudoers
```

> ⚠️ 更安全的做法是使用 `visudo` 命令（自动语法检查）：
> ```bash
> sudo visudo
> ```

## 2. 用户切换

```bash
su username        # 切换到指定用户
sudo su            # 切换到 root
exit               # 退出当前用户会话（也可用 Ctrl+D）
```

## 3. 用户管理

```bash
# 创建用户（/home 下自动建同名目录）
adduser username

# 创建用户（手动指定选项）
useradd -d /home/zyc -m zyc

# 设置/修改密码
passwd username

# 删除用户（含主目录）
userdel -f username
```

### `useradd` 常用选项：
- `-c "comment"`：添加注释
- `-d /path`：指定主目录（配合 `-m` 自动创建）
- `-g group`：指定主组
- `-G group1,group2`：指定附加组
- `-s /bin/bash`：指定登录 Shell
- `-u UID`：指定用户 ID

## 4. 密码策略（基于 PAM）

```bash
# 备份配置
sudo cp /etc/pam.d/system-auth /etc/pam.d/system-auth.bak

# 编辑策略（在 password 行添加或修改）
sudo vim /etc/pam.d/system-auth
```

策略示例（确保包含以下参数）：
```conf
password requisite pam_pwquality.so \
    minlen=12 \
    lcredit=-1 \
    ucredit=-1 \
    dcredit=-1 \
    ocredit=-1 \
    enforce_for_root
```

> 含义：
> - `minlen=12`：密码最小长度 12
> - `lcredit=-1`：至少 1 个小写字母
> - `ucredit=-1`：至少 1 个大写字母
> - `dcredit=-1`：至少 1 个数字
> - `ocredit=-1`：至少 1 个特殊字符（如 `!@#$%`）
> - `enforce_for_root`：对 root 也生效

## 5. 用户组管理

```bash
# 创建组
groupadd groupname
groupadd -g 1001 mygroup    # 指定 GID

# 删除组
groupdel groupname

# 修改组
groupmod -n newname oldname      # 重命名
groupmod -g 2000 mygroup         # 修改 GID

# 将用户加入/移出组（如 wheel）
usermod -a -G wheel username
gpasswd -a username wheel   # 添加
gpasswd -d username wheel   # 移除
```

## 6. 账户安全控制

```bash
# 锁定/解锁用户
passwd -l username   # 锁定
passwd -u username   # 解锁
passwd -S username   # 查看状态

# 禁止用户登录（修改 Shell）
# 将 /etc/passwd 中用户的 shell 改为 /sbin/nologin
# 示例：
# zyc:x:1000:1000::/home/zyc:/sbin/nologin

# 系统级禁止非 root 登录
sudo touch /etc/nologin   # 创建后除 root 外无法登录
sudo rm /etc/nologin      # 恢复登录
```

## 7. 批量创建用户

```bash
# 1. 准备用户列表（格式同 /etc/passwd）
# users.txt 示例：
# user001:x:1001:1001::/home/user001:/bin/bash

sudo newusers users.txt

# 2. 准备密码文件（明文）
# passwd.txt 示例：
# user001:MyPass123!
# user002:MyPass456!

# 3. 取消 shadow（临时）
sudo pwunconv

# 4. 批量设置密码
sudo chpasswd < passwd.txt

# 5. 重新启用 shadow 密码
sudo pwconv
```
