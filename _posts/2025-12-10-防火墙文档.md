---
layout: post
title: 防火墙文档
date: 2025-12-10 09:00:00 +0800
category: 笔记
thumbnail: /style/image/thumbnail.png
icon: note
typora-copy-images-to: ..\style\image
---

* 目录
{:toc}
### 一、centOS 7.x 防火墙firewall

ip地址与子网掩码 与运算 得到 网络地址 和 主机地址
ip地址与子网掩码 非运算 结果与ip地址 或运算  得到广播地址

开启防火墙之前修改 /usr/lib/firewalld/services/ssh.xml    默认ssh端口开放

1.永久开放某个端口

```shell
firewall-cmd --zone=public --add-port=7900/tcp --permanent //永久开启端口
firewall-cmd --zone=public --remove-port=9011/tcp --permanent //关闭端口
参数解析：
–zone #作用域
–add-port=80/tcp #添加端口，格式为：端口/通讯协议
–permanent #永久生效，没有此参数重启后失效
```

2.配置规则

```shell
firewall-cmd --permanent --zone=public --add-rich-rule="rule family="ipv4" source address="192.168.1.1/24" port protocol="tcp" port="18010" accept"

允许[指定IP段]访问本机全部端口：
firewall-cmd --permanent --zone=public --add-rich-rule="rule family="ipv4" source address="192.168.1.0/24" accept"

允许[指定IP段]访问本机8080-8090端口： firewall-cmd --permanent --zone=public --add-rich-rule='rule family="ipv4" source address="192.168.1.0/24" port protocol="tcp" port="8080-8090" accept'
```

删除规则

```shell
firewall-cmd --permanent --zone=public --remove-rich-rule="rule family="ipv4" source address="192.168.1.1/24" port protocol="tcp" port="18010" accept"
```

添加禁止规则：禁止[指定IP]访问本机8080端口：

```shell
firewall-cmd --permanent --zone=public --add-rich-rule='rule family="ipv4" source address="192.168.1.1" port protocol="tcp" port="8080" reject'
```

屏蔽[指定IP](reject)：      

```shell
firewall-cmd --permanent --zone=public --add-rich-rule="rule family=ipv4 source address=43.229.53.61 reject"

firewall-cmd --permanent --zone=public --add-rich-rule="rule family=ipv4 source address='x.x.x.x/24'  drop"
```

3.重载防火墙使配置生效

```shell
firewall-cmd --reload
```

3.查看已经开放的端口和规则

```shell
firewall-cmd --list-port
firewall-cmd --list-all  查看防火墙规则（只显示/etc/firewalld/zones/public.xml中防火墙策略）
firewall-cmd --list-all-zones 查看所有的防火墙策略（即显示/etc/firewalld/zones/下的所有策略）
```

4.防火墙的开关

```shell
systemctl start firewalld.service #开启firewall
systemctl stop firewalld.service #停止firewall
systemctl disable firewalld.service #禁止firewall开机启动
```

5. 查看端口

```shell
netstat -tunlp|grep [服务名]
```

### 二、centOS 6.x 防火墙iptables

1.配置文件路径 /etc/sysconfig/iptables

防火墙最先增加3条规则

```shell
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A INPUT -p icmp -j ACCEPT 
iptables -A INPUT -i lo -j ACCEPT 
```

追加默认ssh端口 22

```shell
iptables -A INPUT -s 0.0.0.0/0 -p tcp --dport 22 -j ACCEPT
```

防火墙最后添加一条阻止其他的规则

```shell
iptables -A INPUT -j REJECT --reject-with icmp-host-prohibited
```



2.规则配置语法

末尾追加

```shell
iptables -A INPUT -s 0.0.0.0/0 -p tcp --dport 9006 -j ACCEPT
```

插入到第4条

```shell
iptables -I INPUT 4 -s 172.16.28.0/24 -p tcp --dport 9007 -j ACCEPT
```

关闭端口

```shell
iptables -A OUTPUT -p tcp --dport 9006 -j DROP
```

保存配置

```shell
service iptables save
```

查看规则序号

```shell
iptables -L -n --line-number
```

删除input 第36条规则

```shell
iptables -D INPUT 36
```

删除OUTPUT 第一条规则

```shell
iptables -D OUTPUT 1
```



3.开关防火墙

```shell
servcie iptables start|stop|restart #启动|停止|重启
chkconfig iptables off #永久关闭防火墙
```
