---
layout: post
title: mysql手动安装
date: 2025-12-10 09:00:00 +0800
category: 笔记
thumbnail: /style/image/thumbnail.png
icon: note
typora-copy-images-to: ..\style\image
---

* 目录
{:toc}
### 一、前置安装条件

1. 安装mysql依赖

   ```shell
   rpm -ivh libaio-0.3.109-13.el7.x86_64.rpm
   rpm -ivh libaio-devel-0.3.109-13.el7.x86_64.rpm
   rpm -ivh numactl-2.0.9-7.el7.x86_64.rpm
   ```

2. 创建mysql用户

   ```shell
   groupadd mysql
   useradd -r -g mysql -s /sbin/nologin mysql
   ```

3. 创建安装mysql的安装文件夹（记住这个安装路径后面配置文件要用）

   ```shell
   mkdir -p /home/app/mysql-5.7.41
   ```

### 二、下载mysql并安装

1. 去官网选择想要的版本下载（https://dev.mysql.com/downloads/mysql/）并将解压后的mysql源码包mysql-5.7.41-el7-x86_64.tar.gz放到服务器路径下

2. 解压并创建配置文件

   ```shell
   tar -zxvf /home/software-lib/mysql-lib/mysql-5.7.41-el7-x86_64.tar.gz --strip-components 1 -C /home/app/mysql-5.7.41
   ```

   在安装根目录也就是/home/app/mysql-5.7.41这里创建配置文件my.cn以防自己修改配置字符编码不对，直接写入创建（配置文件修改就是全部替换安装目录）

   ```shell
   cat > /home/app/mysql-5.7.41/my.cnf <<END
   [mysqld]
   # 设置mysql端口
   port=10010
   # 设置mysql的安装目录
   basedir=/home/app/mysql-5.7.41
   # 设置mysql数据库的数据的存放目录
   datadir=/home/app/mysql-5.7.41/data
   log-error=/home/app/mysql-5.7.41/data/error.log
   pid-file=/home/app/mysql-5.7.41/data/mysql.pid
   socket=/home/app/mysql-5.7.41/data/mysql.sock
   #设置sqlmode,去除ONLY_FULL_GROUP_BY,解除使用group by查询时select 列的限制
   sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
   # 约束TIMESTAMP类型字段，未明确声明为NOT NULL的TIMESTAMP列允许NULL值。
   explicit_defaults_for_timestamp=true
   
   # 服务端使用的字符集默认为UTF8
   character-set-server=UTF8MB4
   
   # 忽略navicat进行访问时域名解析
   skip-name-resolve
   
   event_scheduler = 1
   innodb_file_per_table = 1
   
   # 创建新表时将使用的默认存储引擎
   default-storage-engine=INNODB
   
   # innodb配置
   innodb_buffer_pool_size = 2g
   innodb_log_file_size = 512m
   innodb_flush_method = O_DIRECT
   innodb_flush_log_at_trx_commit = 2
   sync_binlog = 500
   
   # 优化join关联查询
   join_buffer_size = 128m
   
   # MySQL读入缓冲区的大小
   read_buffer_size = 16m
   
   # MySQL的顺序读缓冲区大小
   sort_buffer_size= 8m
   
   # 允许连接失败的次数。这是为了防止有人从该主机试图攻击数据库系统
   max_connect_errors=10
   
   
   #设置mysql设置最大连接数为5000
   max_connections=5000
   #修改mysql全局时区为北京时间，即我们所在的东8区
   default-time_zone = '+8:00'
   #sql查询超时
   #max_execution_time=2000
   
   #GTID模式
   #gtid-mode=on
   #enforce-gtid-consistency
   
   [mysql]
   # 设置mysql客户端默认字符集
   default-character-set=UTF8MB4
   [client]
   # 设置mysql客户端连接服务端时默认使用的端口
   port=10010
   socket=/home/app/mysql-5.7.41/data/mysql.sock
   default-character-set=UTF8MB4
   
   [mysqld_safe]
   log-error=/home/app/mysql-5.7.41/data/mariadb/mariadb.log
   pid-file=/home/app/mysql-5.7.41/data/mariadb/mariadb.pid
   END
   ```

   完成之后要把文件夹下所有文件改为msyql用户的

   ```shell
   chown -R mysql:mysql /home/app/mysql-5.7.41/
   ```

### 三、初始化并注册服务

1. 初始化

   ```shell
   /home/app/mysql-5.7.41/bin/mysqld --defaults-file=/home/app/mysql-5.7.41/my.cnf --initialize --console --user=mysql --basedir=/home/app/mysql-5.7.41 --datadir=/home/app/mysql-5.7.41/data/
   ```

2. 查看mysql默认密码去安装目录的data的error.log里 ，现在时/home/app/mysql-5.7.41/data/error.log

   ```shell
   cat /home/app/mysql-5.7.41/data/error.log
   //记住密码待会登录要用
   ```

3. 创建mariadb日志

   ```shell
   mkdir /home/app/mysql-5.7.41/data/mariadb/   
   touch /home/app/mysql-5.7.41/data/mariadb/mariadb.log
   //这里也改文件加所属用户，也可以单独改这日志文件夹
   chown -R mysql:mysql /home/app/mysql-5.7.41/data/mariadb/
   ```

4. 注册服务和添加全局命令

   ```shell
   注册服务，安装目录下的support-files/mysql.server这个就是服务，拷贝到/etc/init.d/ 然后重命名，然后修改这个服务里的（my.ini配置文件里有写的） basedir= datadir= mysqld_pid_file_path=
   修改的是/etc/init.d/这里的，别搞错了
   cp /home/app/mysql-5.7.41/support-files/mysql.server /etc/init.d/mysql-5.7.41
   vi /etc/init.d/mysql-5.7.41
   
   //示例值
   basedir=/home/app/mysql-5.7.41 
   datadir=/home/app/mysql-5.7.41/data
   mysqld_pid_file_path=/home/app/mysql-5.7.41/data/mysql.pid
   ```

   ```shell
   命令注册开始
   cd /etc/init.d
   chkconfig --add mysql-5.7.41
   设置开机自启
   chkconfig mysql-5.7.41 on
   chmod 755 /etc/init.d/mysql-5.7.41
   
   创建软连接变成全局命令
   ln -sfn /home/app/mysql-5.7.41/bin/mysql /usr/bin/mysql
   touch /home/app/mysql-5.7.41/data/mysql.pid
   ```

5. 启动服务并查看状态

   ```shell
   systemctl start mysql
   systemctl status mysql
   ```

6. 命令行登录并修改密码（作为安全服务命令行登录要指定socket）

   ```shell
   mysql -uroot --socket=/home/app/mysql-5.7.41/data/mysql.sock -p
   上面回车后输入密码登录
   
   修改当前用户的密码
   ALTER USER USER() IDENTIFIED BY 'a.9(frA6926X';
   flush privileges;
   
   修改其他账号密码的方法
   普通修改
   use mysql;
   update user set password=password("G!Rsd2hI&ZAR") where user="root"
   5.7特殊
   update user set authentication_string=password("zEVuAc4WCPRC") where user="root";
   flush privileges;
   ```

   ```shell
   (可选)
   创建普通用户
   use mysql;
   create user 'userTest'@'%' identified by 'WfS3_4KQOPLM';
   grant all privileges on *.* to 'userTest'@'%';
   flush privileges;
   创建只读账号
   GRANT SElECT ON *.* TO 'user_reader'@'%' IDENTIFIED BY "zEVuAc4WCPRC";
   flush privileges;
   ```

   ```shell
   (必要)更新host设为无限制 使得远程可视化软件可连接数据库
   update user set host='%' where host='localhost';
   flush privileges;
   ```

7. 防火墙开放对应端口

   ```shell
   //永久开放10010端口
   firewall-cmd --zone=public --add-port=10010/tcp --permanent
   //重载使命令生效
   firewall-cmd --reload
   //查看端口开放列表
   firewall-cmd --list-port
   ```

### 四、结语
